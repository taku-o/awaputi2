# BubblePop 画面遷移図

## 画面遷移フロー

```
エントリーページ
    ↓ [ゲームスタート]
PWA歓迎画面
    ↓ [始める]
ユーザー名入力画面 (初回のみ)
    ↓ [確定] or [ESCキーでスキップ]
メインメニュー
    ├─ [ゲーム開始] → ステージ選択画面
    ├─ [ショップ] → アイテムショップ画面
    ├─ [設定] → 設定画面
    ├─ [ユーザー情報] → ユーザー情報画面
    └─ [ヘルプ] → ヘルプ画面
```

## 詳細画面遷移

### 1. エントリーページ
**表示内容:**
- ゲームタイトル「BubblePop」
- 説明文「泡を割って高スコアを目指そう！」
- 「ゲームスタート」ボタン

**遷移:**
- ゲームスタート → PWA歓迎画面

### 2. PWA歓迎画面
**表示内容:**
- PWA機能の説明
- 「始める」ボタン

**遷移:**
- 始める → ユーザー名入力画面 (初回) / メインメニュー (2回目以降)

### 3. ユーザー名入力画面
**表示内容:**
- ユーザー名入力フィールド
- 「確定」ボタン
- ESCキーでスキップ可能

**遷移:**
- 確定 → メインメニュー
- ESCキー → メインメニュー (デフォルト名で登録)

### 4. メインメニュー
**表示内容:**
- ゲームタイトル
- メニュー項目:
  - ゲーム開始
  - ショップ
  - 設定
  - ユーザー情報
  - ヘルプ
- プレイヤー情報 (レベル、AP、TAP)

**キーボード操作:**
- ↑↓: メニュー選択
- Enter: 決定
- S: 設定画面へ
- H/F1: ヘルプ画面へ

**遷移:**
- ゲーム開始 → ステージ選択画面
- ショップ → アイテムショップ画面
- 設定 → 設定画面
- ユーザー情報 → ユーザー情報画面
- ヘルプ → ヘルプ画面

### 5. ステージ選択画面
**表示内容:**
- 利用可能なステージ一覧
- 各ステージの情報 (名前、説明、解放条件)
- 「戻る」ボタン

**ステージ一覧:**
1. 1分ステージ (チュートリアル)
2. 普通のアワアワ
3. ちょっと硬いアワアワ
4. かなり硬いアワアワ
5. 特殊なアワアワ
6. 悪夢のアワアワ
7. カオスなアワアワ
8. 究極のアワアワ
9. 全部入りアワアワ
10. ボスアワアワ

**遷移:**
- ステージ選択 → ゲームプレイ画面
- 戻る → メインメニュー

### 6. ゲームプレイ画面
**表示内容:**
- ゲーム画面 (Canvas)
- UI情報:
  - スコア
  - HP
  - 残り時間
  - コンボ数

**キーボード操作:**
- Space: 一時停止
- Escape: メニュー
- M: ミュート切り替え
- F: フルスクリーン切り替え

**遷移:**
- ゲーム終了 → 結果画面
- 一時停止 → 一時停止メニュー
- Escape → メインメニュー

### 7. 結果画面
**表示内容:**
- 最終スコア
- 獲得AP
- 達成した実績
- 統計情報
- 「もう一度」「メニューに戻る」ボタン

**遷移:**
- もう一度 → 同じステージのゲームプレイ画面
- メニューに戻る → メインメニュー

### 8. 設定画面
**表示内容:**
- 音響設定 (マスター音量、効果音、BGM)
- 言語設定
- 品質設定
- アクセシビリティ設定
- キーボードショートカット設定

**遷移:**
- 戻る → メインメニュー
- ESC → メインメニュー

### 9. ヘルプ画面
**表示内容:**
- ゲームの遊び方
- 泡の種類説明
- キーボードショートカット一覧
- FAQ

**遷移:**
- 戻る → メインメニュー
- ESC → メインメニュー

### 10. アイテムショップ画面
**表示内容:**
- 購入可能アイテム一覧
- 各アイテムの効果と価格
- 現在のAP残高
- 購入ボタン

**遷移:**
- 戻る → メインメニュー

### 11. ユーザー情報画面
**表示内容:**
- プレイヤー統計
- 実績一覧
- レベル情報
- データクリア機能

**遷移:**
- 戻る → メインメニュー

## 特殊な遷移

### URL パラメータによる直接アクセス
```
?username=TestUser&skipUsernameInput=true
→ ユーザー名入力をスキップしてメインメニューへ

?debug=true
→ デバッグモードでゲーム開始
```

### エラー時の遷移
- 初期化エラー → エラー画面
- ゲーム中エラー → メインメニューに戻る
- 設定エラー → デフォルト設定で継続

### 一時停止メニュー
**ゲーム中のSpaceキー押下時:**
- ゲーム再開
- 設定
- メインメニューに戻る

## ナビゲーション統合システム

### NavigationContextManager
各シーンで統一されたナビゲーション機能を提供:
- 戻るボタンの統一処理
- キーボードショートカットの統一
- 画面遷移アニメーション
- 履歴管理

### キーボードショートカット (全画面共通)
- **ESC**: 前の画面に戻る / メニューを閉じる
- **H / F1**: ヘルプ画面を開く
- **S**: 設定画面を開く (メインメニューから)
- **Ctrl+Shift+D**: デバッグモード切り替え

### アクセシビリティ対応
- スクリーンリーダー対応
- キーボードナビゲーション
- フォーカス管理
- 高コントラストモード対応