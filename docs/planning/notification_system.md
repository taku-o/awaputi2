# BubblePop 通知システム詳細

## 通知システム概要

BubblePopゲームでは、プレイヤーの進歩や達成を適切にフィードバックするため、包括的な通知システムを実装します。通知は視覚的・音響的両方の方法で提供され、プレイヤーのゲーム体験を向上させます。

## 通知の種類

### 1. チャレンジ通知 (Challenge Notifications)

#### 新チャレンジ通知
- **トリガー**: 新しいチャレンジが利用可能になった時
- **表示内容**: チャレンジ名、説明、報酬情報
- **設定**: `challenges.newChallenge` (デフォルト: true)

#### チャレンジ完了通知
- **トリガー**: チャレンジを完了した時
- **表示内容**: 完了したチャレンジ名、獲得報酬
- **設定**: `challenges.challengeComplete` (デフォルト: true)

#### チャレンジ通知の全体設定
- **有効/無効**: `challenges.enabled` (デフォルト: true)
- **用途**: プレイヤーのモチベーション維持、新コンテンツの案内

### 2. 実績通知 (Achievement Notifications)

#### 実績解除通知
- **トリガー**: 実績を達成した時
- **表示内容**: 実績名、アイコン、獲得AP
- **設定**: `achievements.unlocked` (デフォルト: true)
- **音響**: achievementUnlocked（華やかで達成感のある音）

#### 進捗通知
- **トリガー**: 実績の進捗が更新された時
- **表示内容**: 実績名、現在の進捗、必要値
- **設定**: `achievements.progress` (デフォルト: false)
- **用途**: 長期実績の進捗可視化

#### レア実績通知
- **トリガー**: レアな実績を達成した時
- **表示内容**: 特別な演出付きで実績情報を表示
- **設定**: `achievements.rare` (デフォルト: true)
- **特徴**: 通常の実績通知より目立つ演出

#### 実績通知の全体設定
- **有効/無効**: `achievements.enabled` (デフォルト: true)

### 3. システム通知 (System Notifications)

#### ステージ解放通知
- **トリガー**: 新しいステージが解放された時
- **表示内容**: 解放されたステージ名、説明
- **音響**: stageUnlocked（新しい可能性を表す音）
- **用途**: 新コンテンツの案内

#### レベルアップ通知
- **トリガー**: プレイヤーレベルが上がった時
- **表示内容**: 新しいレベル、獲得特典
- **音響**: levelUp（成長を表す上昇音）
- **用途**: プレイヤーの成長を祝う

#### 警告通知
- **トリガー**: HP低下、時間切れ警告など
- **表示内容**: 警告メッセージ、現在の状況
- **音響**: warningSound（注意を促す音）
- **用途**: 重要な状況の注意喚起

#### システム通知の全体設定
- **有効/無効**: `system.enabled` (デフォルト: true)

## 通知の表示方法

### 視覚的表示

#### 実績通知アニメーション
- **アニメーション**: 右からスライドイン → 一時停止 → フェードアウト
- **持続時間**: 3000ms - 5000ms
- **イージング**: easeOutCubic
- **用途**: 実績解除時

#### レベルアップ通知アニメーション
- **アニメーション**: 中央からスケールイン → パルス → フェードアウト
- **持続時間**: 2000ms - 3000ms
- **イージング**: easeOutElastic
- **用途**: レベルアップ時

#### 通知コンポーネント
- **Toast**: 短時間の簡潔な通知
- **Alert**: 重要な通知（警告など）
- **Banner**: 上部に表示される横長の通知
- **Snackbar**: 下部に表示される通知

### 音響的表示

#### 実績・レベルアップ音響
**achievementUnlocked** (実績解除音)
- **特徴**: 華やかで達成感のある音
- **持続時間**: 2.0秒
- **周波数**: 523-659-784-1047Hz (Cメジャー7th)
- **楽器**: トランペット、シンバル、ストリングス
- **和音構成**: Cメジャー7th (C-E-G-B) の華やかな和音

**levelUp** (レベルアップ音)
- **特徴**: 成長を表す上昇音
- **持続時間**: 1.5秒
- **周波数**: 440-554-659-880Hz (上昇アルペジオ)
- **楽器**: ピアノ、シンセサイザー、軽やかな打楽器
- **音程進行**: A4 → C#5 → E5 → A5 の上昇アルペジオ

#### システム通知音響
**stageUnlocked** (ステージ解放音)
- **特徴**: 新しい可能性を表す音
- **持続時間**: 1.0秒
- **周波数**: 659-784-988Hz (上昇)
- **楽器**: シンセサイザー、ピアノ、軽やかな打楽器

**warningSound** (警告音)
- **特徴**: 注意を促す音
- **持続時間**: 0.5秒
- **周波数**: 440Hz (パルス)
- **楽器**: シンセサイザー、低音の打楽器
- **用途**: HP低下、時間切れ警告

## 通知設定システム

### 設定データ構造
```jsonc
{
  "notifications": {
    "challenges": {
      "enabled": true,
      "newChallenge": true,
      "challengeComplete": true
    },
    "achievements": {
      "enabled": true,
      "unlocked": true,
      "progress": false,
      "rare": true
    },
    "system": {
      "enabled": true
    }
  }
}
```

### 設定の適用
- **個別制御**: 各通知タイプごとに有効/無効を設定可能
- **デフォルト設定**: ほとんどの通知は有効、進捗通知のみ無効
- **リアルタイム反映**: 設定変更の即座な反映
- **アプリ内通知**: アプリ内での表示のみ

## 実装コンポーネント

### 通知コンポーネント
- **LevelUpNotification**: レベルアップ通知の表示
- **AchievementNotification**: 実績通知の表示
- **NotificationToggle**: 通知設定の切り替えUI

### 通知管理システム
- **NotificationManager**: 通知の生成・表示・管理
- **NotificationQueue**: 複数通知の順序管理
- **NotificationSettings**: 通知設定の管理

## 通知の優先度

### 優先度レベル
1. **高優先度**: 警告通知（HP低下、時間切れ）
2. **中優先度**: 実績解除、レベルアップ
3. **低優先度**: 進捗通知、チャレンジ通知

### 表示制御
- **同時表示制限**: 最大3つの通知を同時表示
- **優先度による表示**: 高優先度の通知を優先表示
- **キューイング**: 表示できない通知はキューに保存

## アクセシビリティ対応

### 音響的配慮
- **音量調整**: 通知音の音量を個別調整可能
- **ミュート対応**: 通知音の無効化

## パフォーマンス最適化

### メモリ管理
- **オブジェクトプール**: 通知コンポーネントの再利用
- **遅延読み込み**: 必要な時のみ通知コンポーネントを読み込み
- **ガベージコレクション**: 不要な通知オブジェクトの自動削除

### 描画最適化
- **バッチレンダリング**: 複数通知の一括描画
- **カリング処理**: 画面外の通知を描画しない
- **フレームレート維持**: 60FPS維持のための最適化

## 通知のテスト・デバッグ

### テスト機能
- **通知シミュレーション**: 各通知タイプのテスト表示
- **設定テスト**: 通知設定の動作確認
- **パフォーマンステスト**: 通知表示のパフォーマンス測定

### デバッグ機能
- **通知ログ**: 通知の生成・表示履歴
- **設定状態表示**: 現在の通知設定の確認
- **エラーハンドリング**: 通知表示エラーの適切な処理

## まとめ

BubblePopの通知システムは、プレイヤーの進歩と達成を適切にフィードバックし、ゲーム体験を向上させる重要な機能です。視覚的・音響的両方の方法で通知を提供し、プレイヤーの設定に応じて柔軟にカスタマイズ可能な設計となっています。

通知の種類、表示方法、設定システム、実装コンポーネントなど、包括的な仕様を定義することで、一貫性のある高品質なアプリ内通知体験を提供します。
