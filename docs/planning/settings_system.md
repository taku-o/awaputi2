# BubblePop 設定システム詳細

**要修正**

## 設定カテゴリ

### 音響設定 (Audio Settings)

#### 基本音量設定
- **masterVolume** (マスター音量)
  - **範囲**: 0.0 - 1.0
  - **デフォルト**: 0.7
  - **説明**: 全体の音量を制御

- **sfxVolume** (効果音音量)
  - **範囲**: 0.0 - 1.0
  - **デフォルト**: 0.8
  - **説明**: 泡を割る音などの効果音音量

- **bgmVolume** (BGM音量)
  - **範囲**: 0.0 - 1.0
  - **デフォルト**: 0.5
  - **説明**: 背景音楽の音量

- **isMuted** (ミュート)
  - **タイプ**: boolean
  - **デフォルト**: false
  - **説明**: 全音響のオン/オフ



### 言語設定 (Language Settings)

#### 対応言語
- **language** (表示言語)
  - **選択肢**: 
    - `ja` (日本語) - デフォルト
    - `en` (English)
  - **自動検出**: ブラウザ言語から自動設定（日本語・英語のみ）

### 品質設定 (Quality Settings)

#### 品質設定
- **quality** (品質レベル)
  - **選択肢**:
    - `auto` (自動) - デフォルト
    - `low` (低品質)
    - `medium` (中品質)
    - `high` (高品質)
    - `ultra` (最高品質)

**品質レベルの詳細設定**
品質レベルを変更すると、以下の設定が自動的に調整されます：

- **フレームレート制限**:
  - `auto`: デバイス性能に応じて自動調整
  - `low`: 30fps
  - `medium`: 45fps
  - `high`: 60fps
  - `ultra`: 無制限

- **パーティクル数制限**:
  - `auto`: デバイス性能に応じて自動調整
  - `low`: 50%
  - `medium`: 75%
  - `high`: 100%
  - `ultra`: 150%

- **エフェクト品質**:
  - `auto`: デバイス性能に応じて自動調整
  - `low`: 簡易
  - `medium`: 標準
  - `high`: 高品質
  - `ultra`: 最高品質

### キーボードショートカット設定

#### 基本操作
- **help** (ヘルプ)
  - **デフォルト**: `['F1']`
  - **説明**: ヘルプ画面を開く

### ソーシャル共有設定 (Social Sharing Settings)

#### 基本設定
- **autoPromptHighScore** (ハイスコア時自動プロンプト)
  - **タイプ**: boolean
  - **デフォルト**: true

- **autoPromptAchievements** (実績解除時自動プロンプト)
  - **タイプ**: boolean
  - **デフォルト**: true

#### 共有設定
- **defaultPlatform** (デフォルトプラットフォーム)
  - **選択肢**: `auto`, `twitter`, `facebook`, `native`
  - **デフォルト**: `auto`

- **includeScreenshot** (スクリーンショット含む)
  - **タイプ**: boolean
  - **デフォルト**: true

- **screenshotQuality** (スクリーンショット品質)
  - **選択肢**: `low`, `medium`, `high`
  - **デフォルト**: `high`

### 通知設定 (Notification Settings)

#### チャレンジ通知
- **challenges.enabled** (チャレンジ通知有効)
  - **デフォルト**: true
- **challenges.newChallenge** (新チャレンジ通知)
  - **デフォルト**: true
- **challenges.challengeComplete** (チャレンジ完了通知)
  - **デフォルト**: true

#### 実績通知
- **achievements.enabled** (実績通知有効)
  - **デフォルト**: true
- **achievements.unlocked** (実績解除通知)
  - **デフォルト**: true
- **achievements.progress** (進捗通知)
  - **デフォルト**: false
- **achievements.rare** (レア実績通知)
  - **デフォルト**: true

#### システム通知
- **system.enabled** (システム通知有効)
  - **デフォルト**: true

## 設定システムの仕組み

### 設定管理アーキテクチャ

#### ConfigurationManager
- **中央集権的管理**: 全設定を一元管理
- **カテゴリ分類**: 設定を論理的にグループ化
- **バリデーション**: 設定値の妥当性チェック
- **変更監視**: 設定変更の即座な反映

#### 設定の保存
- **LocalStorage**: ブラウザのローカルストレージに保存
- **JSON形式**: 構造化されたデータ形式
- **自動保存**: 設定変更時の自動保存

### 設定の適用システム

#### リアルタイム反映
- **即座適用**: 設定変更の即座な反映

#### システム連携
- **音響システム**: 音量設定の即座反映
- **描画システム**: 品質レベルの動的変更（フレームレート、パーティクル数、エフェクト品質の自動調整）
- **入力システム**: キーボード設定の更新

### 設定のインポート/エクスポート

#### エクスポート機能
- **JSON形式**: 設定データのJSON出力
- **選択的エクスポート**: 特定カテゴリのみ出力

### アクセシビリティプロファイル

#### カスタムプロファイル
- **個人設定**: ユーザー独自の設定組み合わせ
- **プロファイル保存**: 複数プロファイルの管理

## 設定の技術実装

### データ構造
```javascript
{
  "audio": {
    "masterVolume": 0.7,
    "sfxVolume": 0.8,
    "bgmVolume": 0.5,
    "isMuted": false
  },
  "ui": {
    "language": "ja",
    "quality": "auto",
    "showFPS": false
  },
  "keyboardShortcuts": {
    "help": ["F1"]
  }
}
```

### バリデーションルール
- **型チェック**: boolean, number, string の型検証
- **選択肢チェック**: 有効な選択肢の検証

### パフォーマンス最適化
- **遅延適用**: 設定変更の遅延適用
- **バッチ処理**: 複数設定の一括処理
- **キャッシュ**: 頻繁にアクセスされる設定のキャッシュ
- **差分更新**: 変更された設定のみ更新