# BubblePop 音響システム詳細

## 音響システム構成

### アーキテクチャ概要
- **AudioManager**: 音響システムの中央制御
- **Web Audio API**: 高品質音響処理
- **プロシージャル音響生成**: リアルタイム音響合成
- **5バンドイコライザー**: 周波数帯域制御
- **動的品質調整**: デバイス性能に応じた最適化

### 主要コンポーネント

#### AudioManager (音響管理)
- 全音響システムの統合制御
- 音量制御とミュート機能
- 品質モード管理
- サブシステム連携

#### AudioContextManager
- Web Audio APIの管理
- AudioContextの初期化と制御
- ノード接続の管理
- ブラウザ互換性対応

#### ProceduralSoundGenerator
- リアルタイム音響合成
- 泡割り音の動的生成
- 効果音のバリエーション作成
- メモリ効率的な音響生成

## 音響の種類

### 1. 効果音 (SFX)

#### 泡関連音響
**bubblePop** (泡割り音)
- **生成方法**: プロシージャル合成
- **特徴**: 泡の種類に応じて音程・音色が変化
- **バリエーション**: 20種類以上の異なる音色
- **用途**: 泡を割った時の基本音

**bubblePopNormal** (通常泡)
- **周波数**: 440Hz ベース
- **音色**: 軽やかなポップ音
- **持続時間**: 0.2秒

**bubblePopStone** (石泡)
- **周波数**: 330Hz ベース
- **音色**: 硬質な音
- **持続時間**: 0.3秒

**bubblePopIron** (鉄泡)
- **周波数**: 220Hz ベース
- **音色**: 金属的な響き
- **持続時間**: 0.4秒

**bubblePopDiamond** (ダイヤモンド泡)
- **周波数**: 880Hz ベース
- **音色**: キラキラした高音
- **持続時間**: 0.5秒

**bubblePopRainbow** (虹色泡)
- **周波数**: 440-880Hz グライド
- **音色**: 虹色に変化する音
- **持続時間**: 0.6秒

**bubblePopPink** (回復泡)
- **周波数**: 523Hz ベース
- **音色**: 優しく温かい音
- **持続時間**: 0.4秒

**bubblePopPoison** (毒泡)
- **周波数**: 200Hz ベース
- **音色**: 不気味で低い音
- **持続時間**: 0.5秒

**bubblePopBoss** (ボス泡)
- **周波数**: 110Hz ベース
- **音色**: 重厚で迫力のある音
- **持続時間**: 1.0秒

#### UI関連音響
**uiClick** (UI クリック音)
- **生成方法**: プロシージャル合成
- **周波数**: 800Hz
- **音色**: クリアなクリック音
- **用途**: ボタンクリック、メニュー選択

**uiHover** (UI ホバー音)
- **生成方法**: プロシージャル合成
- **周波数**: 600Hz
- **音色**: 軽やかなホバー音
- **用途**: ボタンホバー時

**uiError** (エラー音)
- **生成方法**: プロシージャル合成
- **周波数**: 200Hz
- **音色**: 警告的な音
- **用途**: エラー発生時

**uiSuccess** (成功音)
- **生成方法**: プロシージャル合成
- **周波数**: 523-659-784Hz (Cメジャーコード)
- **音色**: 明るく成功を表す音
- **用途**: 実績解除、レベルアップ

#### ゲーム状況音響
**comboSound** (コンボ音)
- **生成方法**: プロシージャル合成
- **周波数**: コンボ数に応じて上昇 (440Hz + コンボ数×50Hz)
- **音色**: 連続的に高くなる音
- **用途**: コンボ発生時

**damageSound** (ダメージ音)
- **生成方法**: プロシージャル合成
- **周波数**: 150Hz
- **音色**: 重く痛みを表す音
- **用途**: HPダメージ時

**healSound** (回復音)
- **生成方法**: プロシージャル合成
- **周波数**: 523-659Hz (上昇)
- **音色**: 癒しを表す優しい音
- **用途**: HP回復時

**timeStopSound** (時間停止音)
- **生成方法**: プロシージャル合成
- **周波数**: 440Hz → 220Hz (下降)
- **音色**: 時間が止まる感じの音
- **用途**: 時計泡効果発動時

**explosionSound** (爆発音)
- **生成方法**: プロシージャル合成
- **周波数**: 100-2000Hz (ノイズ)
- **音色**: 迫力のある爆発音
- **用途**: 爆発泡効果時

### 2. 背景音楽 (BGM)

#### メインメニューBGM
**menuTheme** (メニューテーマ)
- **生成方法**: プロシージャル合成
- **調性**: Cメジャー
- **テンポ**: 120 BPM
- **構成**: イントロ + メインループ
- **特徴**: 親しみやすく落ち着いた雰囲気

#### ゲームプレイBGM
**gameplayTheme** (ゲームプレイテーマ)
- **生成方法**: プロシージャル合成
- **調性**: Gメジャー
- **テンポ**: 140 BPM
- **構成**: 動的に変化するループ
- **特徴**: 緊張感とリズム感のあるBGM

**gameplayIntense** (高難易度BGM)
- **生成方法**: プロシージャル合成
- **調性**: Dマイナー
- **テンポ**: 160 BPM
- **構成**: より激しいリズム
- **特徴**: 高難易度ステージ用の緊迫感

#### 環境音楽
**ambientBubbles** (泡の環境音)
- **生成方法**: プロシージャル合成
- **特徴**: 泡がぷくぷくと浮かぶ環境音
- **用途**: 背景の雰囲気作り

### 3. 通知音響

#### 実績・レベルアップ音響
**achievementUnlocked** (実績解除音)
- **生成方法**: プロシージャル合成
- **周波数**: 523-659-784-1047Hz (Cメジャー7th)
- **音色**: 華やかで達成感のある音
- **持続時間**: 2.0秒

**levelUp** (レベルアップ音)
- **生成方法**: プロシージャル合成
- **周波数**: 440-554-659-880Hz (上昇アルペジオ)
- **音色**: 成長を表す上昇音
- **持続時間**: 1.5秒

**newRecord** (新記録音)
- **生成方法**: プロシージャル合成
- **周波数**: ファンファーレ風の和音進行
- **音色**: 祝福的で特別感のある音
- **持続時間**: 3.0秒

#### システム通知音響
**stageUnlocked** (ステージ解放音)
- **生成方法**: プロシージャル合成
- **周波数**: 659-784-988Hz (上昇)
- **音色**: 新しい可能性を表す音
- **持続時間**: 1.0秒

**warningSound** (警告音)
- **生成方法**: プロシージャル合成
- **周波数**: 440Hz (パルス)
- **音色**: 注意を促す音
- **用途**: HP低下、時間切れ警告

## 音響品質システム

### 品質モード
**low** (低品質)
- **サンプルレート**: 22050Hz
- **バッファサイズ**: 2048
- **エフェクト**: 無効
- **用途**: 低性能デバイス

**medium** (中品質)
- **サンプルレート**: 44100Hz
- **バッファサイズ**: 1024
- **エフェクト**: 基本のみ
- **用途**: 標準的なデバイス

**high** (高品質)
- **サンプルレート**: 44100Hz
- **バッファサイズ**: 512
- **エフェクト**: 全て有効
- **用途**: 高性能デバイス

**ultra** (最高品質)
- **サンプルレート**: 48000Hz
- **バッファサイズ**: 256
- **エフェクト**: 最高品質
- **用途**: 最高性能デバイス

### 動的品質調整
- **CPU使用率監視**: リアルタイムでCPU負荷を監視
- **自動品質低下**: 負荷が高い場合に自動的に品質を下げる
- **メモリ使用量制御**: 音響バッファのメモリ使用量を制限
- **レイテンシ最適化**: 入力から音響出力までの遅延を最小化

## 音響エフェクト

### 5バンドイコライザー
**低音域 (60Hz)**
- **タイプ**: ローシェルフフィルター
- **調整範囲**: -12dB ～ +12dB
- **用途**: 重低音の調整

**中低音域 (170Hz)**
- **タイプ**: ピーキングフィルター
- **調整範囲**: -12dB ～ +12dB
- **用途**: 低音の厚みを調整

**中音域 (350Hz)**
- **タイプ**: ピーキングフィルター
- **調整範囲**: -12dB ～ +12dB
- **用途**: 中音域の明瞭度を調整

**中高音域 (1000Hz)**
- **タイプ**: ピーキングフィルター
- **調整範囲**: -12dB ～ +12dB
- **用途**: 音の存在感を調整

**高音域 (3500Hz)**
- **タイプ**: ハイシェルフフィルター
- **調整範囲**: -12dB ～ +12dB
- **用途**: 高音の輝きを調整

### リバーブ効果
- **ルームリバーブ**: 小さな部屋の響き
- **ホールリバーブ**: 大きなホールの響き
- **プレートリバーブ**: 金属板の響き
- **調整可能パラメータ**: ルームサイズ、減衰時間、湿潤度

### コンプレッサー
- **用途**: 音量の動的制御
- **パラメータ**: 
  - スレッショルド: -24dB
  - レシオ: 3:1
  - アタック: 3ms
  - リリース: 250ms

## アクセシビリティ音響機能

### 視覚障害者向け
**音声ガイダンス**
- **メニュー読み上げ**: メニュー項目の音声説明
- **ゲーム状況通知**: スコア、HP、時間の音声通知
- **操作フィードバック**: 操作結果の音声確認

**空間音響**
- **3D音響**: 泡の位置を音で表現
- **距離感**: 泡との距離を音量で表現
- **方向感**: 左右の音響バランスで位置を表現

### 聴覚障害者向け
**視覚的音響表現**
- **音響の視覚化**: 音響レベルの視覚的表示
- **周波数スペクトラム**: 音響の周波数成分を表示
- **リズム表示**: BGMのリズムを視覚的に表現

**振動フィードバック**
- **重要音響の振動**: 重要な音響イベントで振動
- **振動パターン**: 音響の種類に応じた振動パターン
- **強度調整**: 振動の強さを調整可能

## パフォーマンス最適化

### メモリ管理
- **音響バッファプール**: 音響バッファの再利用
- **動的読み込み**: 必要な音響のみメモリに読み込み
- **ガベージコレクション**: 不要な音響データの自動削除
- **メモリ使用量監視**: リアルタイムでメモリ使用量を監視

### CPU最適化
- **バッチ処理**: 複数の音響処理をまとめて実行
- **優先度制御**: 重要な音響を優先的に処理
- **負荷分散**: フレーム間で処理を分散
- **キャッシュ活用**: 計算結果のキャッシュ

### ネットワーク最適化
- **プロシージャル生成**: 音響ファイルのダウンロード不要
- **圧縮**: 必要な音響ファイルの圧縮
- **CDN活用**: 音響ファイルの高速配信
- **プリロード**: 重要な音響の事前読み込み

## 設定システム連携

### 音量制御
- **マスター音量**: 全体音量の制御
- **効果音音量**: SFXのみの音量制御
- **BGM音量**: 背景音楽のみの音量制御
- **個別音響制御**: 特定の音響カテゴリの音量制御

### 音響設定
- **イコライザー設定**: 5バンドEQの保存・読み込み
- **エフェクト設定**: リバーブ、コンプレッサーの設定
- **品質設定**: 音響品質の選択
- **アクセシビリティ設定**: 支援機能の有効/無効

### プリセット機能
- **デフォルト**: 標準的な音響設定
- **ゲーミング**: ゲームに最適化された設定
- **音楽重視**: BGMを重視した設定
- **効果音重視**: SFXを重視した設定
- **アクセシビリティ**: 支援機能を重視した設定

## 技術実装詳細

### Web Audio API活用
- **AudioContext**: 音響処理の中心
- **GainNode**: 音量制御
- **BiquadFilterNode**: イコライザー実装
- **ConvolverNode**: リバーブ効果
- **DynamicsCompressorNode**: コンプレッサー効果

### ブラウザ互換性
- **自動フォールバック**: Web Audio API非対応時のHTML5 Audio使用
- **ベンダープレフィックス**: 各ブラウザの実装差異に対応
- **機能検出**: 利用可能な機能の動的検出
- **エラーハンドリング**: 音響初期化失敗時の適切な処理

### デバッグ・監視機能
- **音響レベルメーター**: リアルタイム音響レベル表示
- **パフォーマンス監視**: CPU・メモリ使用量の監視
- **エラーログ**: 音響関連エラーの詳細ログ
- **統計情報**: 音響システムの使用統計