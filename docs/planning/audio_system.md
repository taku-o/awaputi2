# BubblePop 音響システム詳細

## 音響システム構成

### アーキテクチャ概要
- **AudioManager**: 音響システムの中央制御
- **Phaser Audio**: 高性能なゲーム音響処理（全画面で利用）
- **音響ファイル管理**: 事前録音された音響ファイル
- **5バンドイコライザー**: 周波数帯域制御
- **動的品質調整**: デバイス性能に応じた最適化

### 音響システムの利用範囲
- **タイトル画面**: 音楽なし（ユーザーインタラクション前のため）
- **メインページ（ゲームトップ）**: メニューBGM、UI効果音
- **ゲームプレイ画面**: ゲーム中の効果音、BGM
- **設定画面**: 設定変更時の効果音
- **ヘルプ画面**: ヘルプ表示時の効果音
- **ショップ画面**: ショップBGM、購入効果音
- **全画面共通**: システム音、通知音

### 主要コンポーネント

#### AudioManager (音響管理)
- 全音響システムの統合制御
- 音量制御とミュート機能
- 品質モード管理
- サブシステム連携

#### PhaserAudioManager
- Phaser音響システムの管理
- 音響ファイルの読み込みと管理
- 音響の再生制御
- 音量・ミュート制御

#### SoundFileManager
- 音響ファイルの管理
- 事前録音された音響ファイルの整理
- 音響のキャッシュ管理
- メモリ効率的な音響管理
- **対応フォーマット**: MP3, OGG, WAV
- **ファイル構造**: 
  - `/assets/audio/sfx/` - 効果音
  - `/assets/audio/bgm/` - 背景音楽
  - `/assets/audio/ui/` - UI音響
- **品質管理**: 高品質・中品質・低品質の3段階
- **AI生成対応**: 
  - 音響生成プロンプトの管理
  - 生成された音響ファイルの品質チェック
  - 音響ファイルのメタデータ管理
  - 生成履歴とバージョン管理
  - **周波数・音程情報の保持**: AI生成時の重要な技術的ヒントとして保存

## 音響の種類

### 1. 効果音 (SFX)

#### 泡関連音響
**bubblePop** (泡割り音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 泡の種類に応じて異なる音響ファイルを再生
- **バリエーション**: 20種類以上の異なる音響ファイル
- **用途**: 泡を割った時の基本音
- **AI生成ヒント**: 
  - 基本音: 軽やかなポップ音、持続時間0.2秒
  - バリエーション: 泡の材質・サイズ・色に応じた音色変化
  - 音響特性: 明るく親しみやすい、ゲーム感のある音

**bubblePopNormal** (通常泡)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 軽やかなポップ音
- **持続時間**: 0.2秒
- **周波数**: 440Hz ベース
- **AI生成ヒント**: 明るく親しみやすい、軽やかなポップ音、ゲーム感のある音、A4音程

**bubblePopStone** (石泡)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 硬質な音
- **持続時間**: 0.3秒
- **周波数**: 330Hz ベース
- **AI生成ヒント**: 硬い材質感、石のような重厚感、低めの音程、E4音程

**bubblePopIron** (鉄泡)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 金属的な響き
- **持続時間**: 0.4秒
- **周波数**: 220Hz ベース
- **AI生成ヒント**: 金属的な響き、硬質で冷たい印象、中音域、A3音程

**bubblePopDiamond** (ダイヤモンド泡)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: キラキラした高音
- **持続時間**: 0.5秒
- **周波数**: 880Hz ベース
- **AI生成ヒント**: キラキラとした高音、宝石のような輝き、高音域、A5音程

**bubblePopRainbow** (虹色泡)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 虹色に変化する音
- **持続時間**: 0.6秒
- **周波数**: 440-880Hz グライド
- **AI生成ヒント**: 虹色に変化する音色、魔法のような印象、音程変化、A4→A5のグライド

**bubblePopPink** (回復泡)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 優しく温かい音
- **持続時間**: 0.4秒
- **周波数**: 523Hz ベース
- **AI生成ヒント**: 優しく温かい音、癒しを感じる、中音域、C5音程

**bubblePopPoison** (毒泡)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 不気味で低い音
- **持続時間**: 0.5秒
- **周波数**: 200Hz ベース
- **AI生成ヒント**: 不気味で低い音、危険を感じる、低音域、G3音程

**bubblePopBoss** (ボス泡)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 重厚で迫力のある音
- **持続時間**: 1.0秒
- **周波数**: 110Hz ベース
- **AI生成ヒント**: 重厚で迫力のある音、威圧感、低音域、長めの持続時間、A2音程

#### UI関連音響
**uiClick** (UI クリック音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: クリアなクリック音
- **用途**: ボタンクリック、メニュー選択
- **周波数**: 800Hz ベース
- **AI生成ヒント**: クリアで明確なクリック音、短い持続時間、中音域、G5音程

**uiHover** (UI ホバー音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 軽やかなホバー音
- **用途**: ボタンホバー時
- **周波数**: 600Hz ベース
- **AI生成ヒント**: 軽やかで親しみやすい音、短い持続時間、高音域、D5音程

**uiError** (エラー音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 警告的な音
- **用途**: エラー発生時
- **周波数**: 200Hz ベース
- **AI生成ヒント**: 警告を感じる音、短い持続時間、低音域、G3音程

**uiSuccess** (成功音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 明るく成功を表す音
- **用途**: 実績解除、レベルアップ
- **周波数**: 523-659-784Hz (Cメジャーコード)
- **AI生成ヒント**: 明るく成功を表す音、中程度の持続時間、明るい和音、Cメジャーコードの和音

#### ゲーム状況音響
**comboSound** (コンボ音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: コンボ数に応じて異なる音響ファイルを再生
- **音色**: 連続的に高くなる音
- **用途**: コンボ発生時
- **周波数**: 440-880Hz (上昇進行)
- **AI生成ヒント**: 連続的に高くなる音、コンボ数に応じた音程変化、明るく前向きな音、A4→A5の上昇

**damageSound** (ダメージ音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 重く痛みを表す音
- **用途**: HPダメージ時
- **周波数**: 150Hz ベース
- **AI生成ヒント**: 重く痛みを表す音、低音域、短い持続時間、警告的な音、D3音程

**healSound** (回復音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 癒しを表す優しい音
- **用途**: HP回復時
- **周波数**: 523-659Hz (上昇)
- **AI生成ヒント**: 癒しを表す優しい音、中音域、明るい和音、温かい印象、C5→E5の上昇

**timeStopSound** (時間停止音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 時間が止まる感じの音
- **用途**: 時計泡効果発動時
- **周波数**: 440Hz → 220Hz (下降)
- **AI生成ヒント**: 時間が止まる感じの音、低音域から高音域への変化、神秘的で不思議な音、A4→A3の下降

**explosionSound** (爆発音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 迫力のある爆発音
- **用途**: 爆発泡効果時
- **周波数**: 100-2000Hz (ノイズ)
- **AI生成ヒント**: 迫力のある爆発音、低音域、ノイズ要素、短い持続時間、広帯域ノイズ

### 2. 背景音楽 (BGM)

#### 背景音楽の再生タイミング
**重要な制約**: ユーザーのクリック操作などのインタラクションがないと音楽が流せない環境への対応

**タイトル画面**
- **音楽再生**: なし
- **理由**: ユーザーインタラクション前のため、自動再生が制限される環境がある
- **効果音**: なし

**メインページ（ゲームトップ）**
- **音楽再生**: ユーザーがメインページに入ってから開始
- **開始条件**: ユーザーのクリック操作などのインタラクション後
- **BGM**: menuTheme（メインメニューテーマ）
- **効果音**: UI操作時の効果音

**ゲームプレイ画面**
- **音楽再生**: ゲーム開始と同時に開始
- **BGM**: gameplayTheme（ゲームプレイテーマ）
- **効果音**: ゲーム中の各種効果音

#### メインメニューBGM
**menuTheme** (メインメニューテーマ)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **調性**: Cメジャー
- **テンポ**: 120 BPM
- **構成**: イントロ + メインループ
- **特徴**: 親しみやすく落ち着いた雰囲気
- **再生開始タイミング**: メインページ（ゲームトップ）に入ってから開始
- **再生開始条件**: ユーザーのクリック操作などのインタラクション後
- **周波数**: 基本音程 C4 (261.63Hz) を中心とした和音進行
- **AI生成ヒント**: 
  - 調性: Cメジャー（明るく親しみやすい）
  - テンポ: 120 BPM（中程度のテンポ）
  - 雰囲気: 親しみやすく落ち着いた、ゲーム開始への期待感
  - 楽器: ピアノ、ストリングス、軽やかな打楽器
  - 和音進行: C - F - G - C の基本的な進行

#### ゲームプレイBGM
**gameplayTheme** (ゲームプレイテーマ)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **調性**: Gメジャー
- **テンポ**: 140 BPM
- **構成**: 動的に変化するループ
- **特徴**: 緊張感とリズム感のあるBGM
- **周波数**: 基本音程 G4 (392.00Hz) を中心とした和音進行
- **AI生成ヒント**: 
  - 調性: Gメジャー（明るく前向き）
  - テンポ: 140 BPM（やや速いテンポ）
  - 雰囲気: 緊張感とリズム感、ゲームプレイへの集中
  - 楽器: エレキギター、ドラム、ベース、シンセサイザー
  - 和音進行: G - C - D - G の基本的な進行

**gameplayIntense** (高難易度BGM)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **調性**: Dマイナー
- **テンポ**: 160 BPM
- **構成**: より激しいリズム
- **特徴**: 高難易度ステージ用の緊迫感
- **周波数**: 基本音程 D4 (293.66Hz) を中心とした和音進行
- **AI生成ヒント**: 
  - 調性: Dマイナー（暗く緊張感のある）
  - テンポ: 160 BPM（速いテンポ）
  - 雰囲気: 緊迫感、高難易度への挑戦意欲
  - 楽器: 重いドラム、ディストーションギター、シンセベース
  - 和音進行: Dm - Gm - Am - Dm の暗い進行

#### 環境音楽
**ambientBubbles** (泡の環境音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 泡がぷくぷくと浮かぶ環境音
- **用途**: 背景の雰囲気作り
- **周波数**: 200-800Hz (環境音域)
- **AI生成ヒント**: 
  - 雰囲気: 泡がぷくぷくと浮かぶ環境音
  - 音響特性: 静かで控えめ、ループ再生可能
  - 楽器: シンセサイザー、風鈴、水の音
  - 音量: 背景レベル（メインBGMより控えめ）

### 3. 通知音響

#### 実績・レベルアップ音響
**achievementUnlocked** (実績解除音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 華やかで達成感のある音
- **持続時間**: 2.0秒
- **周波数**: 523-659-784-1047Hz (Cメジャー7th)
- **AI生成ヒント**: 
  - 雰囲気: 華やかで達成感のある音
  - 音響特性: ファンファーレ風、明るい和音
  - 楽器: トランペット、シンバル、ストリングス
  - 持続時間: 2.0秒（十分な達成感を表現）
  - 和音構成: Cメジャー7th (C-E-G-B) の華やかな和音

**levelUp** (レベルアップ音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 成長を表す上昇音
- **持続時間**: 1.5秒
- **周波数**: 440-554-659-880Hz (上昇アルペジオ)
- **AI生成ヒント**: 
  - 雰囲気: 成長を表す上昇音
  - 音響特性: 上昇するアルペジオ、明るい和音
  - 楽器: ピアノ、シンセサイザー、軽やかな打楽器
  - 持続時間: 1.5秒（成長の瞬間を表現）
  - 音程進行: A4 → C#5 → E5 → A5 の上昇アルペジオ

**newRecord** (新記録音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 祝福的で特別感のある音
- **持続時間**: 3.0秒
- **周波数**: ファンファーレ風の和音進行 (C-E-G-C)
- **AI生成ヒント**: 
  - 雰囲気: 祝福的で特別感のある音
  - 音響特性: ファンファーレ風、華やかな和音進行
  - 楽器: オーケストラ、合唱、シンバル
  - 持続時間: 3.0秒（特別な瞬間を十分に表現）
  - 和音進行: Cメジャー → Fメジャー → Gメジャー → Cメジャーの華やかな進行

#### システム通知音響
**stageUnlocked** (ステージ解放音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 新しい可能性を表す音
- **持続時間**: 1.0秒
- **周波数**: 659-784-988Hz (上昇)
- **AI生成ヒント**: 
  - 雰囲気: 新しい可能性を表す音
  - 音響特性: 上昇する音程、明るい和音
  - 楽器: シンセサイザー、ピアノ、軽やかな打楽器
  - 持続時間: 1.0秒（短く印象的）

**warningSound** (警告音)
- **生成方法**: 事前録音された音響ファイル（AI生成）
- **特徴**: 注意を促す音
- **用途**: HP低下、時間切れ警告
- **周波数**: 440Hz (パルス)
- **AI生成ヒント**: 
  - 雰囲気: 注意を促す音
  - 音響特性: 警告的な音、短い持続時間
  - 楽器: シンセサイザー、低音の打楽器
  - 持続時間: 0.5秒（短く警告的）

## 音響品質システム

### 品質モード
**low** (低品質)
- **サンプルレート**: 22050Hz
- **バッファサイズ**: 2048
- **エフェクト**: 無効
- **用途**: 低性能デバイス

**medium** (中品質)
- **サンプルレート**: 44100Hz
- **バッファサイズ**: 1024
- **エフェクト**: 基本のみ
- **用途**: 標準的なデバイス

**high** (高品質)
- **サンプルレート**: 44100Hz
- **バッファサイズ**: 512
- **エフェクト**: 全て有効
- **用途**: 高性能デバイス

**ultra** (最高品質)
- **サンプルレート**: 48000Hz
- **バッファサイズ**: 256
- **エフェクト**: 最高品質
- **用途**: 最高性能デバイス

### 動的品質調整
- **CPU使用率監視**: リアルタイムでCPU負荷を監視
- **自動品質低下**: 負荷が高い場合に自動的に品質を下げる
- **メモリ使用量制御**: 音響バッファのメモリ使用量を制限
- **レイテンシ最適化**: 入力から音響出力までの遅延を最小化

## 音響エフェクト

### 5バンドイコライザー
**低音域 (60Hz)**
- **タイプ**: ローシェルフフィルター
- **調整範囲**: -12dB ～ +12dB
- **用途**: 重低音の調整

**中低音域 (170Hz)**
- **タイプ**: ピーキングフィルター
- **調整範囲**: -12dB ～ +12dB
- **用途**: 低音の厚みを調整

**中音域 (350Hz)**
- **タイプ**: ピーキングフィルター
- **調整範囲**: -12dB ～ +12dB
- **用途**: 中音域の明瞭度を調整

**中高音域 (1000Hz)**
- **タイプ**: ピーキングフィルター
- **調整範囲**: -12dB ～ +12dB
- **用途**: 音の存在感を調整

**高音域 (3500Hz)**
- **タイプ**: ハイシェルフフィルター
- **調整範囲**: -12dB ～ +12dB
- **用途**: 高音の輝きを調整

### リバーブ効果
- **ルームリバーブ**: 小さな部屋の響き
- **ホールリバーブ**: 大きなホールの響き
- **プレートリバーブ**: 金属板の響き
- **調整可能パラメータ**: ルームサイズ、減衰時間、湿潤度

### コンプレッサー
- **用途**: 音量の動的制御
- **パラメータ**: 
  - スレッショルド: -24dB
  - レシオ: 3:1
  - アタック: 3ms
  - リリース: 250ms

## アクセシビリティ音響機能

### 視覚障害者向け
**音声ガイダンス**
- **メニュー読み上げ**: メニュー項目の音声説明
- **ゲーム状況通知**: スコア、HP、時間の音声通知
- **操作フィードバック**: 操作結果の音声確認

**空間音響**
- **3D音響**: 泡の位置を音で表現
- **距離感**: 泡との距離を音量で表現
- **方向感**: 左右の音響バランスで位置を表現

### 聴覚障害者向け
**視覚的音響表現**
- **音響の視覚化**: 音響レベルの視覚的表示
- **周波数スペクトラム**: 音響の周波数成分を表示
- **リズム表示**: BGMのリズムを視覚的に表現

**振動フィードバック**
- **重要音響の振動**: 重要な音響イベントで振動
- **振動パターン**: 音響の種類に応じた振動パターン
- **強度調整**: 振動の強さを調整可能

## パフォーマンス最適化

### メモリ管理
- **音響バッファプール**: 音響バッファの再利用
- **動的読み込み**: 必要な音響のみメモリに読み込み
- **ガベージコレクション**: 不要な音響データの自動削除
- **メモリ使用量監視**: リアルタイムでメモリ使用量を監視

### CPU最適化
- **バッチ処理**: 複数の音響処理をまとめて実行
- **優先度制御**: 重要な音響を優先的に処理
- **負荷分散**: フレーム間で処理を分散
- **キャッシュ活用**: 計算結果のキャッシュ

### ネットワーク最適化
- **音響ファイル管理**: 事前録音された音響ファイルの効率的な管理
- **圧縮**: 必要な音響ファイルの圧縮
- **CDN活用**: 音響ファイルの高速配信
- **プリロード**: 重要な音響の事前読み込み

## 設定システム連携

### 音量制御
- **マスター音量**: 全体音量の制御
- **効果音音量**: SFXのみの音量制御
- **BGM音量**: 背景音楽のみの音量制御
- **個別音響制御**: 特定の音響カテゴリの音量制御

### 音響設定
- **イコライザー設定**: 5バンドEQの保存・読み込み
- **エフェクト設定**: リバーブ、コンプレッサーの設定
- **品質設定**: 音響品質の選択
- **アクセシビリティ設定**: 支援機能の有効/無効

### プリセット機能
- **デフォルト**: 標準的な音響設定
- **ゲーミング**: ゲームに最適化された設定
- **音楽重視**: BGMを重視した設定
- **効果音重視**: SFXを重視した設定
- **アクセシビリティ**: 支援機能を重視した設定

## 技術実装詳細

### Phaser Audio活用
- **Phaser.Sound.BaseSound**: 音響処理の中心
- **Phaser.Sound.BaseSoundManager**: 音響管理
- **Phaser.Sound.HTML5AudioSoundManager**: HTML5音響管理
- **Phaser.Sound.WebAudioSoundManager**: Web Audio音響管理
- **Phaser.Sound.NoAudioSoundManager**: 音響無効時の管理

### ブラウザ互換性
- **自動フォールバック**: Phaserによる自動的な音響システム選択
- **ベンダープレフィックス**: 各ブラウザの実装差異に対応
- **機能検出**: 利用可能な機能の動的検出
- **エラーハンドリング**: 音響初期化失敗時の適切な処理

### デバッグ・監視機能
- **音響レベルメーター**: リアルタイム音響レベル表示
- **パフォーマンス監視**: CPU・メモリ使用量の監視
- **エラーログ**: 音響関連エラーの詳細ログ
- **統計情報**: 音響システムの使用統計

## Phaser音響システムの利点

### 技術的利点
- **自動フォールバック**: HTML5 Audio → Web Audio API → 音響無効の自動選択
- **クロスブラウザ対応**: 各ブラウザの実装差異を自動処理
- **パフォーマンス最適化**: 音響ファイルの効率的な管理と再生
- **メモリ管理**: 音響ファイルの自動キャッシュと解放

### 開発者利点
- **簡単な実装**: 複雑な音響処理をPhaserが自動化
- **豊富なAPI**: 音量、ループ、フェード、3D音響などの高度な制御
- **TypeScript対応**: 完全な型定義による開発効率向上
- **統合環境**: ゲームエンジンと音響システムの完全統合

### ユーザー体験の向上
- **高品質音響**: 事前録音されたプロ品質の音響
- **一貫性**: 全ての音響が統一された品質で再生
- **カスタマイズ**: ユーザー設定による音響調整
- **アクセシビリティ**: 音響無効時の適切な代替機能